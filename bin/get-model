#!/usr/bin/env bash

set -o errexit

BASE_URL="https://huggingface.co/ggerganov/whisper.cpp/resolve/main"
AVAILABLE_MODELS="ggml-tiny.bin
ggml-tiny-q5_1.bin
ggml-tiny-q8_0.bin
ggml-tiny.en.bin
ggml-tiny.en-q5_1.bin
ggml-tiny.en-q8_0.bin
ggml-base.bin
ggml-base-q5_1.bin
ggml-base-q8_0.bin
ggml-base.en.bin
ggml-base.en-q5_1.bin
ggml-base.en-q8_0.bin
ggml-small.bin
ggml-small-q5_1.bin
ggml-small-q8_0.bin
ggml-small.en.bin
ggml-small.en-q5_1.bin
ggml-small.en-q8_0.bin
ggml-small.en-tdrz.bin
ggml-medium.bin
ggml-medium-q5_0.bin
ggml-medium-q8_0.bin
ggml-medium.en.bin
ggml-medium.en-q5_0.bin
ggml-medium.en-q8_0.bin
ggml-large-v1.bin
ggml-large-v2.bin
ggml-large-v2-q5_0.bin
ggml-large-v2-q8_0.bin
ggml-large-v3.bin
ggml-large-v3-q5_0.bin
ggml-large-v3-turbo.bin
ggml-large-v3-turbo-q5_0.bin
ggml-large-v3-turbo-q8_0.bin"
WORK_DIR=$(dirname "$(dirname "$(readlink -f "$0")")")

pushd "$WORK_DIR" >/dev/null

SELECTED_MODEL=$(echo "$AVAILABLE_MODELS" | fzf --height 40% --layout reverse --border)

if [ -n "$SELECTED_MODEL" ]; then
  echo "downloading $SELECTED_MODEL..."
  curl --request GET -L --progress-bar \
       --url "$BASE_URL/$SELECTED_MODEL?download=true" \
       --output "$SELECTED_MODEL"
else
  echo no model selected.
fi

popd >/dev/null
